# Swarm Memory Protocol

This protocol defines the structure and rules for the swarm's long-term memory, which is stored in `memory.log.md`. This file serves as a detailed, human-readable audit trail of every significant agent action, creating a persistent record of the swarm's "experience."

## üèõÔ∏è Core Concept

After every successful or failed task delegation to a Worker agent, the Queen Agent **must** append a new entry to the `memory.log.md` file.

## üìú Log Entry Schema

Each entry in the log must be a Markdown block with the following structure:

```markdown
---
- **Timestamp**: `YYYY-MM-DD HH:MM:SS`
- **WorkflowID**: `A unique ID for the entire integration task`
- **TaskID**: `The ID of the task from workflow-definition.yaml`
- **WorkerAgent**: `The name of the Worker agent that was executed`
- **MCP_Tool(s)**: `The specific MCP tool(s) called from server_fast.py`
- **Phase**: `Planning | Clarification | Mapping | CodeGen | Testing | Finalization`
- **BDIContext**: `{ beliefs: string, desires: string[], intentions: string[] }` (optional)
- **Confidence**: `0.0‚Äì1.0` (optional, per step or aggregate)
- **RetrieverMix**: `bm25 | dense | hybrid` (optional)
- **RationaleBrief**: `one- or two-sentence justification`
- **ActionsTrace**: `[{reason, action, observation}]` (optional)
- **Status**: `SUCCESS` or `FAILURE`
- **Summary of Findings**: `A concise, one-sentence summary of what was achieved or what went wrong.`
- **Output Artifact**: `The absolute path to the file generated by this step, or "N/A".`
- **Inputs Provided**:
  ```json
  {
    "input_parameter_1": "value_1",
    "input_parameter_2": "value_2"
  }
  ```
```

### Plan Update Annotation

When the Queen updates `plan.md`, append a supplemental note to the same log entry:

```markdown
- **PlanUpdate**:
  - task_label: "2.3 Implement date transformation"
  - status_before: "[ ]"
  - status_after: "[x]"
```

### Saved Artifacts Annotation

On successful finalization, include a list of persisted artifacts:

```markdown
- **SavedArtifacts**:
  - "/integrations/[source]-to-[target]/README.md"
  - "/integrations/[source]-to-[target]/mapping.json"
  - "/integrations/[source]-to-[target]/plan.md"
  - "/integrations/[source]-to-[target]/src/connector.kt"
```

## üìù Example Log Entry

```markdown
---
- **Timestamp**: `2025-07-29 12:30:00`
- **WorkflowID**: `personio-to-workday-sync-1690626600`
- **TaskID**: `3`
- **WorkerAgent**: `MappingAgent`
- **MCP_Tool(s)**: `reasoning_agent`
- **Status**: `SUCCESS`
- **Summary of Findings**: `Successfully generated a mapping report with 8/10 fields matched with high confidence.`
- **Output Artifact**: `/path/to/project/outputs/mapping_report_20250729_123000.md`
- **Inputs Provided**:
  ```json
  {
    "analysis_path": "/path/to/project/outputs/source_analysis_20250729_122500.md",
    "spec_path": "/path/to/specs/workday.json",
    "collection_name": "workday_api_v3"
  }
  ```
```

## üì¶ Phase Summary Report Template

After each major phase, append a summary block:

```markdown
---
- **Timestamp**: `YYYY-MM-DD HH:MM:SS`
- **WorkflowID**: `...`
- **Phase**: `1 | 2 | 3`
- **Artifacts**:
  - plan_path: `/abs/path/plan.md` (phase 1)
  - analysis_path: `/abs/path/analysis.md` (phase 1)
  - mapping_report_path: `/abs/path/mapping_report.md` (phase 2)
  - mapping_json_path: `/abs/path/mapping.json` (phase 2)
  - code_path: `/abs/path/Connector.kt` (phase 3)
  - integration_spec_path: `/abs/path/README.md` (phase 3)
- **Key Findings**: `short bullet list`
- **Confidence**: `0.00‚Äì1.00`
- **Clarifications**: `if any`
- **Metrics**: `{ tokens: N, runtime_ms: N, precision: x, recall: y, f1: z }`
```

## üß™ Learnings Report Template

After successful Phase 3 and green tests, create `LEARNINGS.md` in the integration directory:

```markdown
# Learnings

## What Worked
- Bullet list of effective strategies (retriever mix, prompts, codegen patterns)

## Errors and How We Fixed Them
- Error: `...`
- Root cause: `...`
- Fix applied: `...`
- Prevention: `...`

## Do‚Äôs and Don‚Äôts
- Do: `...`
- Don‚Äôt: `...`

## Improvements for Next Time
- `...`

## References
- Link to mapping report, memory log entries, test summary
```